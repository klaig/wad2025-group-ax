<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PostIt - HW3</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <!-- Vue 3 + Vuex 4 + Vue Router 4 from CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vuex@4/dist/vuex.global.js"></script>
    <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.js"></script>
</head>
<body>
    <div id="app"></div>

    <script>
        const { createApp } = Vue
        const { createStore } = Vuex
        const { createRouter, createWebHashHistory } = VueRouter

        // VUEX STORE
        const store = createStore({
            state() {
                return {
                    posts: []
                }
            },

            getters: {
                allPosts: (state) => state.posts,
                getPostById: (state) => (id) => state.posts.find(p => p.id === id)
            },

            mutations: {
                SET_POSTS(state, posts) {
                    state.posts = posts
                },
                INCREMENT_LIKE(state, postId) {
                    const post = state.posts.find(p => p.id === postId)
                    if (post) post.likes++
                },
                RESET_ALL_LIKES(state) {
                    state.posts.forEach(post => post.likes = 0)
                }
            },

            actions: {
                async fetchPosts({ commit }) {
                    const response = await fetch('posts.json')
                    const data = await response.json()
                    commit('SET_POSTS', data.Posts)
                },
                likePost({ commit }, postId) {
                    commit('INCREMENT_LIKE', postId)
                },
                resetLikes({ commit }) {
                    commit('RESET_ALL_LIKES')
                }
            }
        })

        // COMPONENTS
        const HeaderComponent = {
            template: `
                <header id="main-header">
                    <nav class="navbar">
                        <div class="nav-links">
                            <router-link to="/" class="nav-btn">Home</router-link>
                            <router-link to="/signup" class="nav-btn">Sign up</router-link>
                        </div>
                    </nav>
                </header>
            `
        }

        const FooterComponent = {
            template: `
                <footer id="main-footer">
                    <p>&copy; 2025 Group-AX. All rights reserved.</p>
                </footer>
            `
        }

        const PostComponent = {
            props: ['post'],
            template: `
                <article class="post">
                    <div class="post-header">
                        <img src="images/icons8-test-account-50.png" :alt="post.author" class="post-avatar">
                        <span class="post-author">{{ post.author }}</span>
                        <span class="post-date">{{ post.date }}</span>
                    </div>
                    <div class="post-content">
                        <img v-if="post.image" :src="post.image" :alt="post.title" class="post-image">
                        <p>{{ post.description || post.title }}</p>
                    </div>
                    <div class="post-footer">
                        <button class="like-btn" @click="likePost">
                            <i class="fa-regular fa-thumbs-up"></i> Like
                        </button>
                        <span class="like-count">{{ post.likes }} likes</span>
                    </div>
                </article>
            `,
            methods: {
                likePost() {
                    this.$store.dispatch('likePost', this.post.id)
                }
            }
        }

        const MainPage = {
            template: `
                <div>
                    <post-component
                        v-for="post in posts"
                        :key="post.id"
                        :post="post">
                    </post-component>
                    <div class="reset-container">
                        <button class="reset-btn" @click="resetLikes">Reset likes</button>
                    </div>
                </div>
            `,
            computed: {
                posts() {
                    return this.$store.getters.allPosts
                }
            },
            methods: {
                resetLikes() {
                    this.$store.dispatch('resetLikes')
                }
            }
        }

        const SignupPage = {
            template: `
                <div id="signup-page-container">
                    <div class="signup-card">
                        <h3>Create an Account</h3>
                        <form @submit.prevent="validateAndSubmit" class="signup-form">
                            <div class="signup-form-group">
                                <label for="email">Email</label>
                                <div class="signup-input-container">
                                    <input type="email" id="email" v-model="email" placeholder="Email" required>
                                </div>
                            </div>

                            <div class="signup-form-group">
                                <label for="password">Password</label>
                                <div class="signup-input-container">
                                    <input type="password" id="password" v-model="password" placeholder="Password" required>
                                </div>
                            </div>

                            <button type="submit" class="signup-submit-btn">Signup</button>

                            <div v-if="errors.length" class="validation-errors">
                                <p>The password is not valid:</p>
                                <ul>
                                    <li v-for="(error, index) in errors" :key="index">
                                        - {{ error }}
                                    </li>
                                </ul>
                            </div>
                        </form>
                    </div>
                </div>
            `,
            data() {
                return {
                    email: '',
                    password: '',
                    errors: []
                }
            },
            methods: {
                validateAndSubmit() {
                    this.errors = [];
                    const p = this.password;

                    if (p.length < 8 || p.length >= 15) {
                        this.errors.push("Password must be at least 8 characters and less than 15 characters.");
                    }

                    if (!/[A-Z]/.test(p)) {
                        this.errors.push("Includes at least one uppercase alphabet character.");
                    }

                    const lowercaseMatches = p.match(/[a-z]/g) || [];
                    if (lowercaseMatches.length < 2) {
                        this.errors.push("Includes at least two lowercase alphabet characters.");
                    }

                    if (!/[0-9]/.test(p)) {
                        this.errors.push("Includes at least one numeric value.");
                    }

                    if (!/^[A-Z]/.test(p)) {
                        this.errors.push("It should start with an uppercase alphabet character.");
                    }

                    if (!/_/.test(p)) {
                        this.errors.push("It should include the character \"_\".");
                    }

                    if (this.errors.length === 0) {
                        alert("Signup successful!");
                        this.$router.push('/'); 
                    }
                }
            }
        }

        // ROUTER
        const routes = [
            { path: '/', component: MainPage },
            { path: '/signup', component: SignupPage }
        ]

        const router = createRouter({
            history: createWebHashHistory(),
            routes
        })

        // APP
        const app = createApp({
            template: `
                <header-component></header-component>
                <main id="main-container">
                    <aside class="sidebar sidebar-left"></aside>
                    <section class="feed">
                        <router-view></router-view>
                    </section>
                    <aside class="sidebar sidebar-right"></aside>
                </main>
                <footer-component></footer-component>
            `,
            mounted() {
                this.$store.dispatch('fetchPosts')
            }
        })

        app.component('header-component', HeaderComponent)
        app.component('footer-component', FooterComponent)
        app.component('post-component', PostComponent)

        app.use(store)
        app.use(router)

        app.mount('#app')
    </script>
</body>
</html>
